import{l as ee,a as le,c as te}from"./cloud-3a6d1fb9.js";import{d as ae,u as oe}from"./setting-b5212552.js";import{h as ne}from"./moment-fbc5633a.js";import{d as se,a as _,r as P,q as de,b as i,s as re,o as s,c as p,e as l,w as a,F as S,k as $,l as k,v as ie,n as U,f as m,g as D,E as u,p as ue,i as pe,_ as ce}from"./index-056ef9e9.js";import"./index-04cccabd.js";const _e=b=>(ue("data-v-0d2aba58"),b=b(),pe(),b),me={class:"content"},fe=_e(()=>D("span",null,"腾讯Redis集群",-1)),ve={key:0},we={key:1},be={key:0},ye={key:0},ge={key:1},he={key:1},ke={key:0},Ce={class:"dialog-footer"},Ve={class:"dialog-footer"},Ie=se({__name:"Index",setup(b){const y=_(!1),K=(o,t)=>{const w=o[t.property];return w===void 0?"":ne(w).utcOffset(8).format("YYYY-MM-DD HH:mm")},C=_(""),z=_([]),V=_([]),I=P({cloud:"txredis",region:""}),v=_(!1),d=P({cloud:"txredis",instanceid:"",password:""}),H=_([]),f=_(!1),g="100px",n=P({key:"",value:""}),E=async()=>{y.value=!0,I.region=C.value;let o=(await ee(I)).data;o.errorCode===0?(y.value=!1,V.value=o.data.redis_list):(y.value=!1,u.error(o.msg))},x=async()=>{let o=(await le(I)).data;o.errorCode===0?z.value=o.data.region_list:u.error(o.msg)},L=async(o,t)=>{v.value=!0,d.instanceid=t.InstanceId,d.password=t.Password},T=async()=>{if(!d.instanceid)u.error("未获取到的变更集群");else if(!d.password)u.error("未获取到的变更密码");else{const o=await te(d);o.data.errorCode===0?(u.success("密码保存成功"),d.instanceid="",d.password="",v.value=!1,await E()):u.error(o.data.msg),f.value=!1}},q=(o,t)=>{f.value=!0,n.key=t.Key,n.value=t.Value},O=async o=>{if(!o.Key)u.error("未获取到的删除的内容");else{n.key=o.Key;const t=await ae(n);t.data.errorCode===0?(u.success("删除成功"),await x()):u.error(t.data.msg)}},W=async()=>{if(console.log(n),!n.key)u.error("未获取到的变更配置项");else if(!n.value)u.error("未获取到的变更配置值");else{const o=await oe(n);o.data.errorCode===0?(u.success("变更成功"),n.key="",n.value="",await x()):u.error(o.data.msg),f.value=!1}},F=()=>{f.value=!1,n.key="",n.value="",v.value=!1,d.instanceid="",d.password=""};return de(async()=>{await x()}),(o,t)=>{const w=i("el-col"),N=i("el-option"),R=i("el-select"),j=i("el-row"),G=i("el-divider"),r=i("el-table-column"),c=i("el-button"),J=i("el-popconfirm"),Q=i("el-table"),X=i("el-card"),h=i("el-form-item"),A=i("el-input"),B=i("el-form"),M=i("el-dialog"),Z=re("loading");return s(),p("div",me,[l(X,{shadow:"never"},{default:a(()=>[l(j,null,{default:a(()=>[l(w,{span:3},{default:a(()=>[fe]),_:1}),l(w,{span:2},{default:a(()=>[l(R,{modelValue:C.value,"onUpdate:modelValue":t[0]||(t[0]=e=>C.value=e),placeholder:"选择腾讯Region",onChange:t[1]||(t[1]=e=>E())},{default:a(()=>[(s(!0),p(S,null,$(z.value,e=>(s(),k(N,{key:e.RegionName,label:e.RegionName,value:e.Region},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(G),ie((s(),k(Q,{data:V.value,stripe:"",style:{width:"100%"}},{default:a(()=>[l(r,{prop:"InstanceId",label:"ID",width:"140"}),l(r,{prop:"InstanceName",label:"名称",width:"200"}),l(r,{prop:"PrivateIp",label:"内网IP",width:"120"}),l(r,{prop:"Port",label:"端口",width:"65"}),l(r,{prop:"Size",label:"容量",width:"80"}),l(r,{prop:"InstanceStatus",label:"状态",width:"80"}),l(r,{prop:"RedisShardSize",label:"分片大小",width:"80"}),l(r,{prop:"RedisShardNum",label:"分片数量",width:"80"}),l(r,{prop:"RedisReplicasNum",label:"副本数",width:"80"}),l(r,{prop:"NoAuth",label:"鉴权",width:"80"},{default:a(e=>[e.row.NoAuth?(s(),p("span",ve,"否")):U("",!0),e.row.NoAuth?U("",!0):(s(),p("span",we,"是"))]),_:1}),l(r,{prop:"Password",label:"密码",width:"120"},{default:a(e=>[e.row.NoAuth?(s(),p("div",he,[e.row.Password===""?(s(),p("span",ke,"免密登陆")):U("",!0)])):(s(),p("div",be,[e.row.Password===""?(s(),p("span",ye,"未设置密码")):(s(),p("span",ge,"已设置密码"))]))]),_:1}),l(r,{prop:"PublicIp",label:"外网IP",width:"120"}),l(r,{prop:"Createtime",formatter:K,label:"创建时间",width:"150"}),l(r,{label:"操作",width:"300"},{default:a(e=>[l(c,{size:"small",onClick:Y=>L(e.$index,e.row)},{default:a(()=>[m("改密")]),_:2},1032,["onClick"]),l(c,{size:"small",type:"primary",onClick:Y=>q(e.$index,e.row)},{default:a(()=>[m("扩缩")]),_:2},1032,["onClick"]),l(J,{title:"确定要删除Redis吗？","confirm-button-text":"确认","cancel-button-text":"取消","confirm-button-type":"danger","cancel-button-type":"primary",onConfirm:Y=>O(e.row)},{reference:a(()=>[l(c,{size:"small",type:"danger"},{default:a(()=>[m("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[Z,y.value]])]),_:1}),l(M,{modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=e=>v.value=e),title:"更改密码",width:"30%","align-center":""},{footer:a(()=>[D("span",Ce,[l(c,{onClick:t[4]||(t[4]=e=>F())},{default:a(()=>[m("取消")]),_:1}),l(c,{type:"primary",onClick:t[5]||(t[5]=e=>T())},{default:a(()=>[m("确定")]),_:1})])]),default:a(()=>[l(B,{model:d},{default:a(()=>[l(h,{label:"名称","label-width":g},{default:a(()=>[l(R,{modelValue:d.instanceid,"onUpdate:modelValue":t[2]||(t[2]=e=>d.instanceid=e),placeholder:"请选择要更改的实例"},{default:a(()=>[(s(!0),p(S,null,$(V.value,e=>(s(),k(N,{key:e.InstanceName,label:e.InstanceName,value:e.InstanceId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(h,{label:"密码","label-width":g},{default:a(()=>[l(A,{modelValue:d.password,"onUpdate:modelValue":t[3]||(t[3]=e=>d.password=e),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(M,{modelValue:f.value,"onUpdate:modelValue":t[11]||(t[11]=e=>f.value=e),title:"配置变更",width:"30%","align-center":""},{footer:a(()=>[D("span",Ve,[l(c,{onClick:t[9]||(t[9]=e=>F())},{default:a(()=>[m("取消")]),_:1}),l(c,{type:"primary",onClick:t[10]||(t[10]=e=>W())},{default:a(()=>[m("确定")]),_:1})])]),default:a(()=>[l(B,{model:n},{default:a(()=>[l(h,{label:"配置项","label-width":g},{default:a(()=>[l(R,{modelValue:n.key,"onUpdate:modelValue":t[7]||(t[7]=e=>n.key=e),placeholder:"请选择需要变更的配置"},{default:a(()=>[(s(!0),p(S,null,$(H.value,e=>(s(),k(N,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(h,{label:"配置值","label-width":g},{default:a(()=>[l(A,{modelValue:n.value,"onUpdate:modelValue":t[8]||(t[8]=e=>n.value=e),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const $e=ce(Ie,[["__scopeId","data-v-0d2aba58"]]);export{$e as default};
