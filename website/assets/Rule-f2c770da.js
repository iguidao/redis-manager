import{a as y}from"./index-1d9b39de.js";import{b as A}from"./user-41280cac.js";import"./moment-fbc5633a.js";import{d as G,a as c,r as H,q as J,b as r,s as K,o as i,c as v,e as t,w as a,f as h,v as O,l as b,g as $,F as k,k as I,E as s,p as P,i as Q,_ as X}from"./index-94e23d1f.js";const Y=()=>y.get("/rule/v1/list"),Z=d=>y.delete("/rule/v1/del",{params:d}),ee=()=>y.get("/rule/v1/cfg"),te=d=>y.post("/rule/v1/add",d),le=d=>(P("data-v-e7746445"),d=d(),Q(),d),oe={class:"content"},ae=le(()=>$("span",null,"权限配置",-1)),ne={class:"dialog-footer"},re=G({__name:"Rule",setup(d){const m=c(!1),B=c([]),D=c([]),M=c([]),U=c([]),p=c(!1),g="100px",l=H({identity:"",path:"",method:""}),w=async()=>{let n=(await Y()).data;n.errorCode===0?(m.value=!1,B.value=n.data):(m.value=!1,s.error(n.msg));let o=(await A()).data;o.errorCode===0?D.value=o.data:s.error(o.msg);let u=(await ee()).data;u.errorCode===0?(M.value=u.data.url,U.value=u.data.method):s.error(u.msg)},E=async()=>{if(console.log(l),!l.identity)s.error("未获取到的添加的配置");else if(!l.path)s.error("未获取到的添加的配置");else if(!l.method)s.error("未获取到的添加的配置");else{const n=await te(l);n.data.errorCode===0?(s.success("添加成功"),l.identity="",l.path="",l.method="",await w()):s.error(n.data.msg),p.value=!1}},F=async n=>{if(!n.identity)s.error("未获取到的删除的配置");else if(!n.path)s.error("未获取到的删除的配置");else if(!n.method)s.error("未获取到的删除的配置");else{l.identity=n.identity,l.path=n.path,l.method=n.method;const o=await Z(l);o.data.errorCode===0?(s.success("删除成功"),await w()):s.error(o.data.msg)}},N=()=>{p.value=!1,l.identity="",l.path="",l.method=""};return J(async()=>{m.value=!0,await w()}),(n,o)=>{const u=r("el-col"),f=r("el-button"),R=r("el-row"),S=r("el-divider"),_=r("el-table-column"),z=r("el-popconfirm"),L=r("el-table"),q=r("el-card"),V=r("el-option"),C=r("el-select"),x=r("el-form-item"),T=r("el-form"),W=r("el-dialog"),j=K("loading");return i(),v("div",oe,[t(q,{shadow:"never"},{default:a(()=>[t(R,null,{default:a(()=>[t(u,{span:2},{default:a(()=>[ae]),_:1}),t(u,{offset:18,span:3,style:{"min-width":"120px"}},{default:a(()=>[t(f,{size:"small",type:"primary",onClick:o[0]||(o[0]=e=>p.value=!0)},{default:a(()=>[h("添加权限")]),_:1})]),_:1})]),_:1}),t(S),O((i(),b(L,{data:B.value,stripe:"",style:{width:"100%"}},{default:a(()=>[t(_,{prop:"identity",label:"身份",width:"180"}),t(_,{prop:"path",label:"接口"}),t(_,{prop:"method",label:"meth",width:"180"}),t(_,{prop:"note",label:"备注"}),t(_,{label:"操作"},{default:a(e=>[t(z,{title:"确定要删除吗？","confirm-button-text":"确认","cancel-button-text":"取消","confirm-button-type":"danger","cancel-button-type":"primary",onConfirm:se=>F(e.row)},{reference:a(()=>[t(f,{size:"small",type:"danger"},{default:a(()=>[h("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[j,m.value]])]),_:1}),t(W,{modelValue:p.value,"onUpdate:modelValue":o[6]||(o[6]=e=>p.value=e),title:"权限添加",width:"30%","align-center":""},{footer:a(()=>[$("span",ne,[t(f,{onClick:o[4]||(o[4]=e=>N())},{default:a(()=>[h("取消")]),_:1}),t(f,{type:"primary",onClick:o[5]||(o[5]=e=>E())},{default:a(()=>[h("确定")]),_:1})])]),default:a(()=>[t(T,{model:l},{default:a(()=>[t(x,{label:"身份","label-width":g},{default:a(()=>[t(C,{modelValue:l.identity,"onUpdate:modelValue":o[1]||(o[1]=e=>l.identity=e),placeholder:"选择身份"},{default:a(()=>[(i(!0),v(k,null,I(D.value,e=>(i(),b(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"接口","label-width":g},{default:a(()=>[t(C,{modelValue:l.path,"onUpdate:modelValue":o[2]||(o[2]=e=>l.path=e),placeholder:"选择接口"},{default:a(()=>[(i(!0),v(k,null,I(M.value,e=>(i(),b(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"Method","label-width":g},{default:a(()=>[t(C,{modelValue:l.method,"onUpdate:modelValue":o[3]||(o[3]=e=>l.method=e),placeholder:"选择Method"},{default:a(()=>[(i(!0),v(k,null,I(U.value,e=>(i(),b(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const pe=X(re,[["__scopeId","data-v-e7746445"]]);export{pe as default};
