import{l as ee,a as le,c as ae}from"./cloud-3a6d1fb9.js";import{d as oe,u as te}from"./setting-b5212552.js";import{h as ne}from"./moment-fbc5633a.js";import{d as se,a as _,r as R,q as de,b as i,s as re,o as s,c,e as l,w as o,F as S,k as $,l as k,v as ie,n as U,f as m,g as D,E as u,p as ue,i as ce,_ as pe}from"./index-056ef9e9.js";import"./index-04cccabd.js";const _e=b=>(ue("data-v-d5b3e431"),b=b(),ce(),b),me={class:"content"},fe=_e(()=>D("span",null,"阿里Redis集群",-1)),ve={key:0},we={key:1},be={key:0},ye={key:0},ge={key:1},he={key:1},ke={key:0},Ce={class:"dialog-footer"},Ve={class:"dialog-footer"},Ie=se({__name:"Index",setup(b){const y=_(!1),Y=(t,a)=>{const w=t[a.property];return w===void 0?"":ne(w).utcOffset(8).format("YYYY-MM-DD HH:mm")},C=_(""),z=_([]),V=_([]),I=R({cloud:"aliredis",region:""}),v=_(!1),d=R({cloud:"aliredis",instanceid:"",password:""}),K=_([]),f=_(!1),g="100px",n=R({key:"",value:""}),A=async()=>{y.value=!0,I.region=C.value;let t=(await ee(I)).data;t.errorCode===0?(y.value=!1,V.value=t.data.redis_list):(y.value=!1,u.error(t.msg))},N=async()=>{let t=(await le(I)).data;t.errorCode===0?z.value=t.data.region_list:u.error(t.msg)},H=async(t,a)=>{v.value=!0,d.instanceid=a.InstanceId,d.password=a.Password},q=async()=>{if(!d.instanceid)u.error("未获取到的变更集群");else if(!d.password)u.error("未获取到的变更密码");else{const t=await ae(d);t.data.errorCode===0?(u.success("密码保存成功"),d.instanceid="",d.password="",v.value=!1,await A()):u.error(t.data.msg),f.value=!1}},O=(t,a)=>{f.value=!0,n.key=a.Key,n.value=a.Value},T=async t=>{if(!t.Key)u.error("未获取到的删除的内容");else{n.key=t.Key;const a=await oe(n);a.data.errorCode===0?(u.success("删除成功"),await N()):u.error(a.data.msg)}},W=async()=>{if(console.log(n),!n.key)u.error("未获取到的变更配置项");else if(!n.value)u.error("未获取到的变更配置值");else{const t=await te(n);t.data.errorCode===0?(u.success("变更成功"),n.key="",n.value="",await N()):u.error(t.data.msg),f.value=!1}},E=()=>{f.value=!1,n.key="",n.value="",v.value=!1,d.instanceid="",d.password=""};return de(async()=>{await N()}),(t,a)=>{const w=i("el-col"),x=i("el-option"),P=i("el-select"),j=i("el-row"),G=i("el-divider"),r=i("el-table-column"),p=i("el-button"),J=i("el-popconfirm"),Q=i("el-table"),X=i("el-card"),h=i("el-form-item"),F=i("el-input"),B=i("el-form"),L=i("el-dialog"),Z=re("loading");return s(),c("div",me,[l(X,{shadow:"never"},{default:o(()=>[l(j,null,{default:o(()=>[l(w,{span:3},{default:o(()=>[fe]),_:1}),l(w,{span:2},{default:o(()=>[l(P,{modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value=e),placeholder:"选择阿里Region",onChange:a[1]||(a[1]=e=>A())},{default:o(()=>[(s(!0),c(S,null,$(z.value,e=>(s(),k(x,{key:e.LocalName,label:e.LocalName,value:e.RegionId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(G),ie((s(),k(Q,{data:V.value,stripe:"",style:{width:"100%"}},{default:o(()=>[l(r,{prop:"InstanceId",label:"ID",width:"140"}),l(r,{prop:"InstanceName",label:"名称",width:"200"}),l(r,{prop:"PrivateIp",label:"内网IP",width:"120"}),l(r,{prop:"Port",label:"端口",width:"65"}),l(r,{prop:"Size",label:"容量",width:"80"}),l(r,{prop:"InstanceStatus",label:"状态",width:"80"}),l(r,{prop:"RedisShardSize",label:"分片大小",width:"80"}),l(r,{prop:"RedisShardNum",label:"分片数量",width:"80"}),l(r,{prop:"RedisReplicasNum",label:"副本数",width:"80"}),l(r,{prop:"NoAuth",label:"鉴权",width:"80"},{default:o(e=>[e.row.NoAuth?(s(),c("span",ve,"否")):U("",!0),e.row.NoAuth?U("",!0):(s(),c("span",we,"是"))]),_:1}),l(r,{prop:"Password",label:"密码",width:"120"},{default:o(e=>[e.row.NoAuth?(s(),c("div",he,[e.row.Password===""?(s(),c("span",ke,"免密登陆")):U("",!0)])):(s(),c("div",be,[e.row.Password===""?(s(),c("span",ye,"未设置密码")):(s(),c("span",ge,"已设置密码"))]))]),_:1}),l(r,{prop:"PublicIp",label:"外网IP",width:"120"}),l(r,{prop:"Createtime",formatter:Y,label:"创建时间",width:"150"}),l(r,{label:"操作",width:"300"},{default:o(e=>[l(p,{size:"small",onClick:M=>H(e.$index,e.row)},{default:o(()=>[m("改密")]),_:2},1032,["onClick"]),l(p,{size:"small",type:"primary",onClick:M=>O(e.$index,e.row)},{default:o(()=>[m("扩缩")]),_:2},1032,["onClick"]),l(J,{title:"确定要删除Redis吗？","confirm-button-text":"确认","cancel-button-text":"取消","confirm-button-type":"danger","cancel-button-type":"primary",onConfirm:M=>T(e.row)},{reference:o(()=>[l(p,{size:"small",type:"danger"},{default:o(()=>[m("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[Z,y.value]])]),_:1}),l(L,{modelValue:v.value,"onUpdate:modelValue":a[6]||(a[6]=e=>v.value=e),title:"更改密码",width:"30%","align-center":""},{footer:o(()=>[D("span",Ce,[l(p,{onClick:a[4]||(a[4]=e=>E())},{default:o(()=>[m("取消")]),_:1}),l(p,{type:"primary",onClick:a[5]||(a[5]=e=>q())},{default:o(()=>[m("确定")]),_:1})])]),default:o(()=>[l(B,{model:d},{default:o(()=>[l(h,{label:"名称","label-width":g},{default:o(()=>[l(P,{modelValue:d.instanceid,"onUpdate:modelValue":a[2]||(a[2]=e=>d.instanceid=e),placeholder:"请选择要更改的实例"},{default:o(()=>[(s(!0),c(S,null,$(V.value,e=>(s(),k(x,{key:e.InstanceName,label:e.InstanceName,value:e.InstanceId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(h,{label:"密码","label-width":g},{default:o(()=>[l(F,{modelValue:d.password,"onUpdate:modelValue":a[3]||(a[3]=e=>d.password=e),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(L,{modelValue:f.value,"onUpdate:modelValue":a[11]||(a[11]=e=>f.value=e),title:"配置变更",width:"30%","align-center":""},{footer:o(()=>[D("span",Ve,[l(p,{onClick:a[9]||(a[9]=e=>E())},{default:o(()=>[m("取消")]),_:1}),l(p,{type:"primary",onClick:a[10]||(a[10]=e=>W())},{default:o(()=>[m("确定")]),_:1})])]),default:o(()=>[l(B,{model:n},{default:o(()=>[l(h,{label:"配置项","label-width":g},{default:o(()=>[l(P,{modelValue:n.key,"onUpdate:modelValue":a[7]||(a[7]=e=>n.key=e),placeholder:"请选择需要变更的配置"},{default:o(()=>[(s(!0),c(S,null,$(K.value,e=>(s(),k(x,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(h,{label:"配置值","label-width":g},{default:o(()=>[l(F,{modelValue:n.value,"onUpdate:modelValue":a[8]||(a[8]=e=>n.value=e),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const $e=pe(Ie,[["__scopeId","data-v-d5b3e431"]]);export{$e as default};
